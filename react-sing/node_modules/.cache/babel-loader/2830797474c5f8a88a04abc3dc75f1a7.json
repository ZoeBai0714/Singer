{"ast":null,"code":"var _jsxFileName = \"/Users/xuebai/flatiron/Singer/react-sing/src/App.js\";\nimport React from 'react';\nimport SearchBar from './Component/SearchBar';\nimport SongList from './Component/SongList';\nimport Recorder from './Component/Recorder';\nimport Comment from './Component/Comment';\nimport socketIO from 'socket.io-client'; //const io = socketIO('localhost:3000/')\n\nconst io = socketIO('http://10.185.5.84:3000/');\n\nclass App extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      songIds: [],\n      record: false,\n      handle: \"\",\n      comment: \"\" // pass videoIds to songList \n\n    };\n\n    this.songList = songIds => {\n      this.setState({\n        songIds: songIds\n      });\n    };\n\n    this.reaction = e => {\n      e.preventDefault();\n      io.emit('comment', {\n        message: e.target.children[2].value,\n        handle: e.target.children[0].value\n      });\n      this.setState({\n        handle: e.target.children[0].value,\n        comment: e.target.children[2].value\n      });\n    };\n\n    this.sendAudioBuffer = bufferData => {\n      //convert buffer data\n      console.log(bufferData);\n      io.emit('audioBuffer', bufferData);\n    };\n  }\n\n  componentDidMount() {\n    io.on('comment', messageData => {\n      const commentArea = document.getElementById('output');\n      return commentArea.innerHTML += '<p>' + messageData.handle + ':' + messageData.message + '</p>';\n    }); //let audioCtx = new AudioContext()\n    //let source = audioCtx.createBufferSource()\n\n    var audioElement = document.createElement('audio');\n    audioElement.autoplay = true;\n\n    if (window.MediaSource) {\n      var mediaSource = new MediaSource();\n      audioElement.src = URL.createObjectURL(mediaSource);\n      mediaSource.addEventListener('sourceopen', sourceOpen);\n      console.log(audioElement);\n    } else {\n      console.log(\"The Media Source Extensions API is not supported.\");\n    }\n\n    function sourceOpen(e) {\n      //URL.revokeObjectURL(audioElement.src);\n      var mime = \"audio/webm;codecs=opus\";\n      var mediaSource = e.target;\n      var sourceBuffer = mediaSource.addSourceBuffer(mime); // sourceBuffer.addEventListener('updateend', function(e) {\n      //   if (!sourceBuffer.updating && mediaSource.readyState === 'open') {\n      //     mediaSource.endOfStream();\n      //   }\n      // });\n\n      let first = true;\n      io.on('audioBuffer', arrayBuffer => {\n        if (!sourceBuffer.updating) sourceBuffer.appendBuffer(arrayBuffer);\n        first = false; // for(let channel = 0; channel < channels; channel ++){\n        //   let nowBuffering = myArrayBuffer.getChannelData(channel);\n        //   for(let i = 0; i < frameCount; i++){\n        //     nowBuffering[i]\n        //   }\n        // }\n        //  audioCtx.decodeAudioData(recordedBlob.bufferData, (buffer)=>{\n        //     source.buffer = buffer\n        //     source.connect(audioCtx.destination);\n        //     source.start() \n        //  })\n        //var newblob = new File([recordedBlob.bufferData], \"filename\")\n        // var audioURL = window.URL.createObjectURL(newblob);\n        // window.audio = new Audio();\n        // window.audio.src = audioURL;\n        // window.audio.play();\n      });\n    }\n  }\n\n  // {\n  //   bufferData: bufferData\n  // }\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103\n      },\n      __self: this\n    }, React.createElement(SearchBar, {\n      songList: this.songList,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104\n      },\n      __self: this\n    }), React.createElement(SongList, {\n      songIds: this.state.songIds,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105\n      },\n      __self: this\n    }), React.createElement(Recorder, {\n      sendAudioBuffer: this.sendAudioBuffer,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106\n      },\n      __self: this\n    }), React.createElement(Comment, {\n      reaction: this.reaction,\n      handle: this.state.handle,\n      comment: this.state.comment\n      /*displayComments = {this.displayComments}*/\n      ,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107\n      },\n      __self: this\n    }));\n  }\n\n}\n\nexport default App;\n/*\n const handleSubmit = (e) =>{\n   e.preventDefault()\n   let request = gapi.client.youtube.search.list({\n     part:\"snippet\",\n     channelId:\"UCwTRjvjVge51X-ILJ4i22ew\",\n     q:e.target.value\n   })\n }\n  const init = () =>{\n   gapi.client.setApiKey(\"AIzaSyBlG_6DX-JMovaElRRI4KqXl_k0KAyHH_0\");\n   gapi.client.load(\"youtube\", \"v3\", function(){\n    })\n}\n */","map":{"version":3,"sources":["/Users/xuebai/flatiron/Singer/react-sing/src/App.js"],"names":["React","SearchBar","SongList","Recorder","Comment","socketIO","io","App","Component","state","songIds","record","handle","comment","songList","setState","reaction","e","preventDefault","emit","message","target","children","value","sendAudioBuffer","bufferData","console","log","componentDidMount","on","messageData","commentArea","document","getElementById","innerHTML","audioElement","createElement","autoplay","window","MediaSource","mediaSource","src","URL","createObjectURL","addEventListener","sourceOpen","mime","sourceBuffer","addSourceBuffer","first","arrayBuffer","updating","appendBuffer","render"],"mappings":"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","sourcesContent":["import React from 'react';\nimport SearchBar from './Component/SearchBar'\nimport SongList from './Component/SongList'\nimport Recorder from './Component/Recorder'\nimport Comment from './Component/Comment'\nimport socketIO from 'socket.io-client';\n//const io = socketIO('localhost:3000/')\nconst io = socketIO('http://10.185.5.84:3000/')\n\nclass App extends React.Component {\n  state = {\n    songIds:[],\n    record:false,\n    handle:\"\",\n    comment:\"\"\n  }\n\n  // pass videoIds to songList \n   songList = (songIds) =>{\n    this.setState({\n      songIds:songIds\n    })\n  }\n\n  reaction = (e) => {\n    e.preventDefault()\n    io.emit('comment',  {\n       message: e.target.children[2].value,\n       handle: e.target.children[0].value,\n    })\n      this.setState({\n        handle:e.target.children[0].value,\n        comment:e.target.children[2].value\n      })\n  }\n  \n  \n   \n\n  componentDidMount() {\n    io.on('comment', messageData => {\n     const commentArea = document.getElementById('output')\n     return commentArea.innerHTML += '<p>' + messageData.handle + ':' + messageData.message + '</p>'\n    })\n    //let audioCtx = new AudioContext()\n    //let source = audioCtx.createBufferSource()\n    var audioElement = document.createElement('audio');\n     audioElement.autoplay = true\nif (window.MediaSource) {\n  var mediaSource = new MediaSource();\n  audioElement.src = URL.createObjectURL(mediaSource);\n  mediaSource.addEventListener('sourceopen', sourceOpen);\n  console.log(audioElement)\n} else {\n  console.log(\"The Media Source Extensions API is not supported.\")\n}\n\nfunction sourceOpen(e) {\n  //URL.revokeObjectURL(audioElement.src);\n  var mime = \"audio/webm;codecs=opus\";\n  var mediaSource = e.target;\n  var sourceBuffer = mediaSource.addSourceBuffer(mime);\n  // sourceBuffer.addEventListener('updateend', function(e) {\n  //   if (!sourceBuffer.updating && mediaSource.readyState === 'open') {\n  //     mediaSource.endOfStream();\n  //   }\n  // });\n    let first = true\n    io.on('audioBuffer', (arrayBuffer)=>{\n      \n      if (!sourceBuffer.updating) sourceBuffer.appendBuffer(arrayBuffer);\n      first = false\n      // for(let channel = 0; channel < channels; channel ++){\n      //   let nowBuffering = myArrayBuffer.getChannelData(channel);\n      //   for(let i = 0; i < frameCount; i++){\n      //     nowBuffering[i]\n      //   }\n      // }\n\n      //  audioCtx.decodeAudioData(recordedBlob.bufferData, (buffer)=>{\n      //     source.buffer = buffer\n      //     source.connect(audioCtx.destination);\n      //     source.start() \n      //  })\n      //var newblob = new File([recordedBlob.bufferData], \"filename\")\n      // var audioURL = window.URL.createObjectURL(newblob);\n      // window.audio = new Audio();\n      // window.audio.src = audioURL;\n      // window.audio.play();\n    })\n   }\n  }\n  sendAudioBuffer = bufferData =>{\n    //convert buffer data\n    console.log(bufferData)\n    io.emit('audioBuffer', bufferData)\n  }\n  // {\n  //   bufferData: bufferData\n  // }\n  render(){\n    return(\n         <div>\n            <SearchBar songList = {this.songList}/>\n            <SongList songIds = {this.state.songIds}/>\n            <Recorder sendAudioBuffer = {this.sendAudioBuffer}/>\n            <Comment reaction = {this.reaction} handle = {this.state.handle} comment = {this.state.comment}  /*displayComments = {this.displayComments}*/ />\n         </div>\n        \n    )\n  }\n}\n\n\nexport default App;\n /*\n  const handleSubmit = (e) =>{\n    e.preventDefault()\n    let request = gapi.client.youtube.search.list({\n      part:\"snippet\",\n      channelId:\"UCwTRjvjVge51X-ILJ4i22ew\",\n      q:e.target.value\n    })\n  }\n\n  const init = () =>{\n    gapi.client.setApiKey(\"AIzaSyBlG_6DX-JMovaElRRI4KqXl_k0KAyHH_0\");\n    gapi.client.load(\"youtube\", \"v3\", function(){\n\n    })\n}\n  */"]},"metadata":{},"sourceType":"module"}